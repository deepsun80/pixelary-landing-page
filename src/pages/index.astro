---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Scene1Hero from '../components/Scene1Hero.astro';
import Scene2Services from '../components/Scene2Services.astro';
import Scene3Contact from '../components/Scene3Contact.astro';
import Footer from '../components/Footer.astro';
---

<BaseLayout>
  <Header />
  <Scene1Hero />
  <Scene2Services />
  <Scene3Contact />
  <Footer />
</BaseLayout>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  // ===== SCENE 1: Hero Animation =====

  // Pin scene 1
  ScrollTrigger.create({
    trigger: '#scene-1',
    start: 'top top',
    end: '+=500',
    pin: true,
  });

  // Fade out tagline
  gsap.to('#hero-tagline', {
    opacity: 0,
    y: -20,
    ease: 'none',
    scrollTrigger: {
      trigger: '#scene-1',
      start: 'top top',
      end: '+=150',
      scrub: true,
    },
  });

  // Fade out scroll indicator
  gsap.to('#scroll-indicator', {
    opacity: 0,
    ease: 'none',
    scrollTrigger: {
      trigger: '#scene-1',
      start: 'top top',
      end: '+=100',
      scrub: true,
    },
  });

  // Shrink and move hero logo up and left
  gsap.to('#hero-logo', {
    scale: 0.2,
    x: -515,
    y: 0,
    ease: 'none',
    scrollTrigger: {
      trigger: '#scene-1',
      start: 'top top',
      end: '+=300',
      scrub: true,
    },
  });

  // Fade out hero logo at the end
  gsap.to('#hero-logo', {
    opacity: 0,
    ease: 'none',
    scrollTrigger: {
      trigger: '#scene-1',
      start: '+=300',
      end: '+=350',
      scrub: true,
    },
  });

  // Show header
  gsap.to('#header', {
    opacity: 1,
    y: 0,
    ease: 'none',
    scrollTrigger: {
      trigger: '#scene-1',
      start: '+=100',
      end: '+=150',
      scrub: true,
    },
  });

  // Show header logo
  gsap.to('#header-logo', {
    opacity: 1,
    ease: 'none',
    scrollTrigger: {
      trigger: '#scene-1',
      start: '+=400',
      end: '+=450',
      scrub: true,
    },
  });

  // ===== SCENE 2: Services Animation =====

  // Set initial states
  gsap.set('#diamond-single', { opacity: 0 });
  gsap.set('#diamonds-container', { opacity: 0 });
  gsap.set('#diamond-1', { x: 300 });
  gsap.set('#diamond-3', { x: -300 });
  gsap.set('#diamond-content-1', { opacity: 0 });
  gsap.set('#diamond-content-2', { opacity: 0 });
  gsap.set('#diamond-content-3', { opacity: 0 });

  // Create timeline for Scene 2
  const scene2Tl = gsap.timeline({
    scrollTrigger: {
      trigger: '#scene-2',
      start: 'top top',
      end: '+=1000',
      pin: true,
      scrub: true,
    },
  });

  // Step 1: Single diamond fades in (0% - 15% of timeline)
  scene2Tl.to('#diamond-single', {
    opacity: 1,
    duration: 0.15,
  });

  // Pause - diamond sits visible (15% - 25%)
  scene2Tl.to({}, { duration: 0.1 });

  // Step 2: Single diamond fades out, three diamonds fade in (25% - 35%)
  scene2Tl.to('#diamond-single', {
    opacity: 0,
    duration: 0.1,
  });

  scene2Tl.to(
    '#diamonds-container',
    {
      opacity: 1,
      duration: 0.1,
    },
    '<',
  ); // Same time as above

  // Step 3: Diamonds spread horizontally (35% - 60%)
  scene2Tl.to(
    '#diamond-1',
    {
      x: 0,
      duration: 0.25,
    },
    '<',
  );

  scene2Tl.to(
    '#diamond-3',
    {
      x: 0,
      duration: 0.25,
    },
    '<',
  );

  // Step 4: Content fades in (50% - 70%)
  scene2Tl.to(
    ['#diamond-content-1', '#diamond-content-2', '#diamond-content-3'],
    {
      opacity: 1,
      duration: 0.2,
    },
    '-=0.1',
  ); // Slightly overlapping with spread

  // Hold at end (70% - 100%) - diamonds stay visible
  scene2Tl.to({}, { duration: 0.3 });

  // ===== SCENE 3: Contact Animation =====

  // Set initial states
  gsap.set('#sphere', { x: 300 });
  gsap.set('#contact-form-wrapper', { opacity: 0 });
  gsap.set('#contact-text', { opacity: 0 });

  // Create timeline for Scene 3
  const scene3Tl = gsap.timeline({
    scrollTrigger: {
      trigger: '#scene-3',
      start: 'top top',
      end: '+=800',
      pin: true,
      scrub: true,
    },
  });

  // Step 1: Sphere rolls in from right (0% - 30%)
  scene3Tl.to('#sphere', {
    x: 0,
    duration: 0.3,
    ease: 'none',
  });

  // Step 2: Contact form fades in (25% - 50%)
  scene3Tl.to(
    '#contact-form-wrapper',
    {
      opacity: 1,
      duration: 0.25,
    },
    '-=0.05',
  );

  // Step 3: Text fades in (40% - 65%)
  scene3Tl.to(
    '#contact-text',
    {
      opacity: 1,
      duration: 0.25,
    },
    '-=0.1',
  );

  // Hold at end (65% - 100%) - everything stays visible
  scene3Tl.to({}, { duration: 0.35 });
</script>
